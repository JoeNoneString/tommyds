<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>TommyDS</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="tommy.css" rel="stylesheet" type="text/css">
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-21967501-2']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body>
<!-- Generated by Doxygen 1.8.9.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Tommy Multi Indexing </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Tommy provides only partial iterator support with the "foreach" functions.</p>
<p>If you need real iterators you have to insert all the objects also in a <a class="el" href="tommylist_8h.html#a45d098412d5f0be21113b252caee491b" title="Double linked list type. ">tommy_list</a>, and use the list as iterator.</p>
<p>This technique allows to keep track of the insertion order with the list, and provides more search possibilities using different data structures for different search keys.</p>
<p>See the next example, for a objects inserted in a <a class="el" href="tommylist_8h.html#a45d098412d5f0be21113b252caee491b" title="Double linked list type. ">tommy_list</a>, and in two <a class="el" href="tommyhashdyn_8h.html#a00c8b944d273f38f9eef91417a1e8991" title="Hashtable container type. ">tommy_hashdyn</a> using different keys.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>object {</div>
<div class="line">    <span class="comment">// data fields</span></div>
<div class="line">    <span class="keywordtype">int</span> value_0;</div>
<div class="line">    <span class="keywordtype">int</span> value_1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// for containers</span></div>
<div class="line">    <a class="code" href="structtommy__node__struct.html">tommy_node</a> list_node; <span class="comment">// node for the list</span></div>
<div class="line">    <a class="code" href="structtommy__node__struct.html">tommy_node</a> hash_node_0; <span class="comment">// node for the first hash</span></div>
<div class="line">    <a class="code" href="structtommy__node__struct.html">tommy_node</a> hash_node_1; <span class="comment">// node for the second hash</span></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// search function for value_1</span></div>
<div class="line"><span class="keywordtype">int</span> search_1(<span class="keyword">const</span> <span class="keywordtype">void</span>* arg, <span class="keyword">const</span> <span class="keywordtype">void</span>* obj)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> *(<span class="keyword">const</span> <span class="keywordtype">int</span>*)arg != ((<span class="keyword">const</span> <span class="keyword">struct</span> <span class="keywordtype">object</span>*)obj)-&gt;value_1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="structtommy__hashdyn__struct.html">tommy_hashdyn</a> hash_0;</div>
<div class="line"><a class="code" href="structtommy__hashdyn__struct.html">tommy_hashdyn</a> hash_1;</div>
<div class="line"><a class="code" href="structtommy__node__struct.html">tommy_list</a> list;</div>
<div class="line"></div>
<div class="line"><span class="comment">// initializes the hash tables and the list</span></div>
<div class="line"><a class="code" href="tommyhashdyn_8h.html#a912bebbbb99e453f9c3230948f332d76">tommy_hashdyn_init</a>(&amp;hash_0);</div>
<div class="line"><a class="code" href="tommyhashdyn_8h.html#a912bebbbb99e453f9c3230948f332d76">tommy_hashdyn_init</a>(&amp;hash_1);</div>
<div class="line"><a class="code" href="tommylist_8h.html#a2fc05289c0e8797ffe45e28b9d3671ff">tommy_list_init</a>(&amp;list);</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">// creates an object and inserts it</span></div>
<div class="line">struct <span class="keywordtype">object</span>* obj = malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <span class="keywordtype">object</span>));</div>
<div class="line">obj-&gt;value_0 = ...;</div>
<div class="line">obj-&gt;value_1 = ...;</div>
<div class="line"><span class="comment">// inserts in the first hash table</span></div>
<div class="line"><a class="code" href="tommyhashdyn_8h.html#adef3d60ad281f391ae1032f43f584dac">tommy_hashdyn_insert</a>(&amp;hash_0, &amp;obj-&gt;hash_node_0, obj, <a class="code" href="tommyhash_8h.html#aea9c8438064a941d13e6f5462b5bff71">tommy_inthash_u32</a>(obj-&gt;value_0));</div>
<div class="line"><span class="comment">// inserts in the second hash table</span></div>
<div class="line"><a class="code" href="tommyhashdyn_8h.html#adef3d60ad281f391ae1032f43f584dac">tommy_hashdyn_insert</a>(&amp;hash_1, &amp;obj-&gt;hash_node_1, obj, <a class="code" href="tommyhash_8h.html#aea9c8438064a941d13e6f5462b5bff71">tommy_inthash_u32</a>(obj-&gt;value_1));</div>
<div class="line"><span class="comment">// inserts in the list</span></div>
<div class="line"><a class="code" href="tommylist_8h.html#a98e34efdc68731f3e6da976e4d54ef63">tommy_list_insert_tail</a>(&amp;list, &amp;obj-&gt;list_node, obj);</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">// searches an object by value_1 and deletes it</span></div>
<div class="line">int value_to_find = ...;</div>
<div class="line"><span class="keyword">struct </span>object* obj = <a class="code" href="tommyhashdyn_8h.html#a713b5dc93110677d6230d601909fd667">tommy_hashdyn_search</a>(&amp;hash_1, search_1, &amp;value_to_find, <a class="code" href="tommyhash_8h.html#aea9c8438064a941d13e6f5462b5bff71">tommy_inthash_u32</a>(value_to_find));</div>
<div class="line"><span class="keywordflow">if</span> (obj) {</div>
<div class="line">    <span class="comment">// if found removes all the references</span></div>
<div class="line">    <a class="code" href="tommyhashdyn_8h.html#a0d9f4ca17314d1a0e8b7072b5fda25cc">tommy_hashdyn_remove_existing</a>(&amp;hash_0, &amp;obj-&gt;hash_node_0);</div>
<div class="line">    <a class="code" href="tommyhashdyn_8h.html#a0d9f4ca17314d1a0e8b7072b5fda25cc">tommy_hashdyn_remove_existing</a>(&amp;hash_1, &amp;obj-&gt;hash_node_1);</div>
<div class="line">    <a class="code" href="tommylist_8h.html#ad2dfbf52d6cd1a3f55d0822e90386905">tommy_list_remove_existing</a>(&amp;list, &amp;obj-&gt;list_node);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">// complex iterator logic</span></div>
<div class="line">tommy_node* i = <a class="code" href="tommylist_8h.html#aa9e7b5d591c265d71d518e27f7589d47">tommy_list_head</a>(&amp;list);</div>
<div class="line"><span class="keywordflow">while</span> (i != 0) {</div>
<div class="line">   <span class="comment">// get the object</span></div>
<div class="line">   <span class="keyword">struct </span>object* obj = i-&gt;<a class="code" href="structtommy__node__struct.html#a6210792ec52fa1efbfb44cf4557d9b6f">data</a>;</div>
<div class="line">   ...</div>
<div class="line">   <span class="comment">// go to the next element</span></div>
<div class="line">   i = i-&gt;<a class="code" href="structtommy__node__struct.html#a53338f3f5366866598ed9ac7e46e64a2">next</a>;</div>
<div class="line">   ...</div>
<div class="line">   <span class="comment">// go to the prev element</span></div>
<div class="line">   i = i-&gt;<a class="code" href="structtommy__node__struct.html#a5f5ffba676428636553612ddd809443c">prev</a>;</div>
<div class="line">   ...</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">// deallocates the objects iterating the list</span></div>
<div class="line">tommy_list_foreach(&amp;list, free);</div>
<div class="line"></div>
<div class="line"><span class="comment">// deallocates the hash tables</span></div>
<div class="line"><a class="code" href="tommyhashdyn_8h.html#acc92e6ad011a22aa645cb35d24df27a2">tommy_hashdyn_done</a>(&amp;hash_0);</div>
<div class="line"><a class="code" href="tommyhashdyn_8h.html#acc92e6ad011a22aa645cb35d24df27a2">tommy_hashdyn_done</a>(&amp;hash_1);</div>
</div><!-- fragment --> </div></div><!-- contents -->
</body>
</html>
